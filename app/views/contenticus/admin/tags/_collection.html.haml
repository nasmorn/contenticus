.section.panel.panel-default
  = form.fields_for tag.key, tag do |tag_form|
    .panel-heading
      .btn-toolbar.pull-right
        .btn-group
          - toggle_published_color = tag.published? ? 'success' : 'default'
          = content_tag(:button, class: "btn btn-#{toggle_published_color}", onclick: "window.CMS.toggle_published(this); return false;") do
            %span.glyphicon.glyphicon-off
          - fields = content_tag(:div, field_for_tag(tag_form, tag.add_tag), class: 'collectible')
          = content_tag(:button, class: "btn btn-primary", onclick: "return add_fields(this, \"tags\", \"#{escape_javascript(fields)}\")") do
            %span.glyphicon.glyphicon-plus
      .h3.panel-title
        = tag.name

    .panel-body.sortable.fields-wrapper
      = field_for_tag tag_form, tag.published_tag
      - tag.tags.each do |nested_tag|
        .collectible
          = field_for_tag tag_form, nested_tag
